<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="scheduler">
	<select id="findJobs" resultType="com.dianping.cricket.scheduler.pojo.Job">
		select `id`, `name`, `group`, `description`, `owner`, `schedule`, `main_entry` as mainEntry, `type`, `created_time` as createdTime, `updated_time` as updatedTime 
		from job
	</select>
	<insert id="createJob" parameterType="com.dianping.cricket.scheduler.pojo.Job" useGeneratedKeys="true" keyProperty="id">
		insert into job(`id`, `name`, `group`, `description`, `owner`, `schedule`, `main_entry`, `type`) 
		values(0, #{name}, #{group}, #{description}, #{owner}, #{schedule}, #{mainEntry}, #{type})
	</insert>
	<insert id="createJobStatus" parameterType="com.dianping.cricket.scheduler.pojo.JobStatus">
		insert into job_status(`id`, `status`, `recovered`, `start_time`, `end_time`) values (#{jobId}, #{status}, #{recovered}, #{startTime}, #{endTime});
	</insert>
	<insert id="logStatus" parameterType="com.dianping.cricket.scheduler.pojo.JobStatus">
		insert into job_history(`id`, `job`, `status`, `recovered`, `start_time`, `end_time`) values (0, #{jobId}, #{status}, #{recovered}, #{startTime}, #{endTime});
	</insert>
	<update id="updateStatus" parameterType="com.dianping.cricket.scheduler.pojo.Job">
		update job_status set status = #{status}, start_time = #{startTime}, end_time = #{endTime} 
		where id = #{jobId}
	</update>
</mapper>